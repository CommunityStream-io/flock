<section class="auth-section">
  <div class="auth-container">
    <h2 class="step-title">Authenticate with Bluesky</h2>
    <p class="step-description">Authenticate with Bluesky to migrate</p>

    <form [formGroup]="authForm" (ngSubmit)="onSubmit()" class="auth-form bluesky-auth">
      <div class="form-fields">
        <!-- Username Field -->
        <mat-form-field appearance="outline" class="username-field">
          <mat-label>Username</mat-label>
          <input
            matInput
            formControlName="username"
            name="username"
            placeholder="@username.bksy.social"
            type="text"
            autocomplete="username"
            [class.error]="authForm.get('username')?.invalid && authForm.get('username')?.touched"
          >
          <mat-icon matSuffix>account_circle</mat-icon>
          @if (authForm.get('username')?.invalid && authForm.get('username')?.touched) {
            <mat-error class="username-error mat-error">
              {{ getUsernameErrorMessage() }}
            </mat-error>
          }
          <mat-hint>Must start with @ and contain at least two dots (e.g., @username.bksy.social)</mat-hint>
        </mat-form-field>

        <!-- Password Field -->
        <mat-form-field appearance="outline" class="password-field">
          <mat-label>Password</mat-label>
          <input
            matInput
            formControlName="password"
            name="password"
            placeholder="Enter your password"
            type="password"
            autocomplete="current-password"
            [class.error]="authForm.get('password')?.invalid && authForm.get('password')?.touched"
          >
          <mat-icon matSuffix>lock</mat-icon>
          @if (authForm.get('password')?.invalid && authForm.get('password')?.touched) {
            <mat-error class="password-error mat-error">
              {{ getPasswordErrorMessage() }}
            </mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Authentication Status Display -->
      @if (authError()) {
        <div class="auth-error form-error error-message">
          <mat-icon class="error-icon">error</mat-icon>
          <span class="error-message">{{ authError() }}</span>
        </div>
      }
      
      @if (isAuthenticated() && !authError()) {
        <div class="auth-success success-message">
          <mat-icon class="success-icon">check_circle</mat-icon>
          <span class="success-message">Authentication successful! You can now proceed to the next step.</span>
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="submit"
          mat-raised-button
          color="primary"
          class="submit-button"
          [disabled]="!isFormValid()"
          [class.loading]="isAuthenticating()"
        >
          @if (!isAuthenticating()) {
            <mat-icon>check</mat-icon>
          }
          @if (isAuthenticating()) {
            <mat-spinner diameter="20"></mat-spinner>
          }
          <span>{{ isAuthenticating() ? 'Authenticating...' : 'Authenticate' }}</span>
        </button>
      </div>
    </form>

    <!-- Help Information -->
    <div class="help-section">
      <mat-card class="help-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>help</mat-icon>
            Need Help?
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Your Bluesky username should look like:</p>
          <ul>
            <li><code>@username.bksy.social</code> - for Bluesky's default domain</li>
            <li><code>@user.custom.domain</code> - for custom Personal Data Servers (PDS)</li>
          </ul>
          <p>Make sure to include the @ symbol and that your username contains at least two dots.</p>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</section>
